{% extends "base.html" %}

{% block title %}ì €ì¥ëœ ë²ˆí˜¸ - LottoPro-AI v3.0{% endblock %}

{% block extra_head %}
<style>
/* ì €ì¥ëœ ë²ˆí˜¸ í˜ì´ì§€ ì „ìš© ìŠ¤íƒ€ì¼ */
.prediction-card {
    background: var(--glass-bg);
    backdrop-filter: blur(20px);
    border: 1px solid var(--border-color);
    border-radius: var(--radius-xl);
    padding: var(--space-lg);
    margin-bottom: var(--space-lg);
    transition: all var(--transition-normal);
    position: relative;
    overflow: hidden;
}

.prediction-card::before {
    content: '';
    position: absolute;
    top: 0;
    left: -100%;
    width: 100%;
    height: 3px;
    background: var(--gradient-primary);
    transition: left var(--transition-normal);
}

.prediction-card:hover {
    transform: translateY(-5px);
    box-shadow: var(--shadow-xl), 0 0 30px rgba(102, 126, 234, 0.2);
    border-color: rgba(102, 126, 234, 0.3);
}

.prediction-card:hover::before {
    left: 0;
}

.prediction-card.checked {
    border-color: rgba(34, 197, 94, 0.5);
    background: rgba(34, 197, 94, 0.05);
}

.prediction-card.checked::before {
    background: var(--gradient-success);
    left: 0;
}

.prediction-header {
    display: flex;
    justify-content: space-between;
    align-items: flex-start;
    margin-bottom: var(--space-md);
    flex-wrap: wrap;
    gap: var(--space-sm);
}

.prediction-meta {
    flex: 1;
    min-width: 200px;
}

.prediction-date {
    color: var(--text-secondary);
    font-size: 0.875rem;
    margin-bottom: var(--space-xs);
}

.prediction-algorithm {
    display: inline-flex;
    align-items: center;
    background: var(--gradient-primary);
    color: white;
    padding: 0.25rem 0.75rem;
    border-radius: var(--radius-sm);
    font-size: 0.75rem;
    font-weight: 600;
    text-transform: uppercase;
    letter-spacing: 0.05em;
}

.prediction-actions {
    display: flex;
    gap: var(--space-xs);
    flex-wrap: wrap;
}

.action-btn {
    width: 36px;
    height: 36px;
    border-radius: var(--radius-md);
    border: 1px solid var(--border-color);
    background: var(--glass-bg);
    color: var(--text-primary);
    display: flex;
    align-items: center;
    justify-content: center;
    cursor: pointer;
    transition: all var(--transition-fast);
    font-size: 0.875rem;
}

.action-btn:hover {
    transform: scale(1.1);
    border-color: transparent;
}

.action-btn.edit:hover {
    background: var(--gradient-accent);
    color: white;
}

.action-btn.check:hover {
    background: var(--gradient-success);
    color: white;
}

.action-btn.delete:hover {
    background: var(--gradient-warning);
    color: white;
}

.action-btn.copy:hover {
    background: var(--gradient-secondary);
    color: white;
}

.prediction-numbers {
    display: flex;
    gap: var(--space-sm);
    margin-bottom: var(--space-md);
    flex-wrap: wrap;
    justify-content: center;
}

.prediction-number {
    width: 45px;
    height: 45px;
    border-radius: 50%;
    background: var(--gradient-primary);
    color: white;
    display: flex;
    align-items: center;
    justify-content: center;
    font-size: 1.125rem;
    font-weight: 700;
    box-shadow: var(--shadow-md);
    transition: all var(--transition-fast);
}

.prediction-number:hover {
    transform: scale(1.1);
    box-shadow: var(--shadow-lg);
}

.prediction-number.matched {
    background: var(--gradient-success);
    animation: matchPulse 1s ease-in-out infinite alternate;
}

@keyframes matchPulse {
    0% {
        transform: scale(1);
        box-shadow: 0 0 0 0 rgba(34, 197, 94, 0.4);
    }
    100% {
        transform: scale(1.05);
        box-shadow: 0 0 20px 0 rgba(34, 197, 94, 0.4);
    }
}

.match-result {
    background: rgba(0, 0, 0, 0.2);
    border-radius: var(--radius-lg);
    padding: var(--space-md);
    margin-top: var(--space-md);
    border: 1px solid rgba(34, 197, 94, 0.3);
}

.match-summary {
    display: flex;
    justify-content: space-between;
    align-items: center;
    margin-bottom: var(--space-sm);
    flex-wrap: wrap;
}

.match-count {
    font-size: 1.5rem;
    font-weight: 700;
    color: var(--text-primary);
}

.match-count .number {
    color: #22c55e;
    font-size: 2rem;
}

.match-prize {
    color: #fbbf24;
    font-weight: 600;
}

.matched-numbers {
    display: flex;
    gap: var(--space-xs);
    margin-top: var(--space-sm);
    flex-wrap: wrap;
    justify-content: center;
}

.matched-number {
    width: 32px;
    height: 32px;
    border-radius: 50%;
    background: var(--gradient-success);
    color: white;
    display: flex;
    align-items: center;
    justify-content: center;
    font-size: 0.875rem;
    font-weight: 600;
    box-shadow: var(--shadow-sm);
}

.stats-grid {
    display: grid;
    grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
    gap: var(--space-lg);
    margin-bottom: var(--space-xl);
}

.stat-card {
    background: var(--glass-bg);
    backdrop-filter: blur(20px);
    border: 1px solid var(--border-color);
    border-radius: var(--radius-xl);
    padding: var(--space-lg);
    text-align: center;
    transition: all var(--transition-normal);
}

.stat-card:hover {
    transform: translateY(-5px);
    box-shadow: var(--shadow-xl);
    border-color: rgba(102, 126, 234, 0.3);
}

.stat-value {
    font-size: 2.5rem;
    font-weight: 800;
    background: var(--gradient-primary);
    -webkit-background-clip: text;
    background-clip: text;
    -webkit-text-fill-color: transparent;
    margin-bottom: var(--space-xs);
}

.stat-label {
    color: var(--text-secondary);
    font-size: 0.875rem;
    font-weight: 500;
}

.empty-state {
    text-align: center;
    padding: var(--space-xl) var(--space-lg);
    color: var(--text-secondary);
}

.empty-state i {
    font-size: 4rem;
    color: var(--text-muted);
    margin-bottom: var(--space-lg);
}

.empty-state h3 {
    color: var(--text-primary);
    font-size: 1.5rem;
    font-weight: 600;
    margin-bottom: var(--space-md);
}

.empty-state p {
    max-width: 400px;
    margin: 0 auto var(--space-lg);
}

.filter-bar {
    background: var(--glass-bg);
    backdrop-filter: blur(20px);
    border: 1px solid var(--border-color);
    border-radius: var(--radius-xl);
    padding: var(--space-lg);
    margin-bottom: var(--space-xl);
    display: flex;
    gap: var(--space-md);
    align-items: center;
    flex-wrap: wrap;
}

.filter-group {
    display: flex;
    align-items: center;
    gap: var(--space-sm);
}

.filter-label {
    color: var(--text-primary);
    font-weight: 500;
    white-space: nowrap;
}

.filter-select {
    background: rgba(255, 255, 255, 0.1);
    border: 1px solid var(--border-color);
    border-radius: var(--radius-md);
    padding: var(--space-xs) var(--space-sm);
    color: var(--text-primary);
    font-size: 0.875rem;
    cursor: pointer;
}

.filter-select:focus {
    outline: none;
    border-color: #667eea;
    box-shadow: 0 0 0 2px rgba(102, 126, 234, 0.2);
}

.search-input {
    flex: 1;
    min-width: 200px;
    background: rgba(255, 255, 255, 0.1);
    border: 1px solid var(--border-color);
    border-radius: var(--radius-md);
    padding: var(--space-sm) var(--space-md);
    color: var(--text-primary);
    font-size: 0.875rem;
}

.search-input:focus {
    outline: none;
    border-color: #667eea;
    box-shadow: 0 0 0 2px rgba(102, 126, 234, 0.2);
}

.search-input::placeholder {
    color: var(--text-muted);
}

.bulk-actions {
    display: flex;
    gap: var(--space-sm);
    margin-bottom: var(--space-lg);
    flex-wrap: wrap;
}

.bulk-action-btn {
    padding: var(--space-sm) var(--space-md);
    border-radius: var(--radius-md);
    border: 1px solid var(--border-color);
    background: var(--glass-bg);
    color: var(--text-primary);
    font-size: 0.875rem;
    cursor: pointer;
    transition: all var(--transition-fast);
    display: flex;
    align-items: center;
    gap: var(--space-xs);
}

.bulk-action-btn:hover {
    background: var(--gradient-primary);
    color: white;
    border-color: transparent;
}

.bulk-action-btn:disabled {
    opacity: 0.5;
    cursor: not-allowed;
}

.check-modal {
    background: var(--glass-bg);
    backdrop-filter: blur(20px);
    border: 1px solid var(--border-color);
    border-radius: var(--radius-xl);
    padding: var(--space-xl);
    max-width: 500px;
    width: 90%;
}

.winning-numbers-input {
    display: grid;
    grid-template-columns: repeat(6, 1fr);
    gap: var(--space-sm);
    margin-bottom: var(--space-lg);
}

.winning-number-input {
    width: 100%;
    aspect-ratio: 1;
    border-radius: 50%;
    background: var(--glass-bg);
    border: 2px solid var(--border-color);
    color: var(--text-primary);
    text-align: center;
    font-weight: 600;
    font-size: 1.125rem;
    transition: all var(--transition-fast);
}

.winning-number-input:focus {
    outline: none;
    border-color: #667eea;
    background: rgba(102, 126, 234, 0.1);
}

@media (max-width: 768px) {
    .prediction-header {
        flex-direction: column;
        align-items: stretch;
    }
    
    .prediction-actions {
        justify-content: center;
        margin-top: var(--space-sm);
    }
    
    .filter-bar {
        flex-direction: column;
        align-items: stretch;
    }
    
    .filter-group {
        justify-content: space-between;
    }
    
    .bulk-actions {
        justify-content: center;
    }
    
    .stats-grid {
        grid-template-columns: repeat(auto-fit, minmax(150px, 1fr));
    }
    
    .winning-numbers-input {
        grid-template-columns: repeat(3, 1fr);
        gap: var(--space-md);
    }
    
    .prediction-numbers {
        justify-content: center;
    }
    
    .prediction-number {
        width: 40px;
        height: 40px;
        font-size: 1rem;
    }
}
</style>
{% endblock %}

{% block content %}
<!-- í—¤ë” ì„¹ì…˜ -->
<section class="py-20">
    <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
        <div class="text-center mb-12">
            <h1 class="text-5xl md:text-6xl font-black bg-gradient-to-r from-purple-400 via-pink-400 to-red-400 bg-clip-text text-transparent mb-6">
                ì €ì¥ëœ ë²ˆí˜¸
            </h1>
            <p class="text-xl text-purple-200 max-w-3xl mx-auto">
                AIê°€ ì˜ˆì¸¡í•œ ë²ˆí˜¸ë“¤ì„ ê´€ë¦¬í•˜ê³  <span class="text-pink-300 font-bold">ë‹¹ì²¨ë²ˆí˜¸ì™€ ë¹„êµ</span>í•´ë³´ì„¸ìš”
            </p>
        </div>
        
        <!-- í†µê³„ ì¹´ë“œ -->
        <div class="stats-grid" id="user-stats">
            <div class="stat-card">
                <div class="stat-value" id="total-predictions">0</div>
                <div class="stat-label">ì´ ì˜ˆì¸¡ìˆ˜</div>
            </div>
            <div class="stat-card">
                <div class="stat-value" id="total-matches">0</div>
                <div class="stat-label">ì´ ì ì¤‘ìˆ˜</div>
            </div>
            <div class="stat-card">
                <div class="stat-value" id="best-match">0</div>
                <div class="stat-label">ìµœê³  ì ì¤‘</div>
            </div>
            <div class="stat-card">
                <div class="stat-value" id="accuracy-rate">0%</div>
                <div class="stat-label">ì •í™•ë„</div>
            </div>
        </div>
    </div>
</section>

<!-- ë©”ì¸ ì»¨í…ì¸  -->
<section class="pb-20">
    <div class="max-w-6xl mx-auto px-4 sm:px-6 lg:px-8">
        <!-- í•„í„° ë°” -->
        <div class="filter-bar">
            <div class="filter-group">
                <label class="filter-label">ì •ë ¬:</label>
                <select id="sort-select" class="filter-select">
                    <option value="date-desc">ìµœì‹ ìˆœ</option>
                    <option value="date-asc">ì˜¤ë˜ëœìˆœ</option>
                    <option value="matches-desc">ì ì¤‘ìˆ˜ ë†’ì€ìˆœ</option>
                    <option value="matches-asc">ì ì¤‘ìˆ˜ ë‚®ì€ìˆœ</option>
                </select>
            </div>
            
            <div class="filter-group">
                <label class="filter-label">í•„í„°:</label>
                <select id="filter-select" class="filter-select">
                    <option value="all">ì „ì²´</option>
                    <option value="checked">í™•ì¸ë¨</option>
                    <option value="unchecked">ë¯¸í™•ì¸</option>
                    <option value="matches">ì ì¤‘</option>
                </select>
            </div>
            
            <input type="text" id="search-input" class="search-input" placeholder="ì•Œê³ ë¦¬ì¦˜ ì´ë¦„ìœ¼ë¡œ ê²€ìƒ‰...">
            
            <button id="add-manual" class="btn-primary">
                <i class="fas fa-plus mr-2"></i>ìˆ˜ë™ ì¶”ê°€
            </button>
        </div>
        
        <!-- ì¼ê´„ ì‘ì—… -->
        <div class="bulk-actions" id="bulk-actions" style="display: none;">
            <button id="select-all" class="bulk-action-btn">
                <i class="fas fa-check-square"></i>ì „ì²´ ì„ íƒ
            </button>
            <button id="bulk-check" class="bulk-action-btn">
                <i class="fas fa-search"></i>ì„ íƒí•­ëª© í™•ì¸
            </button>
            <button id="bulk-delete" class="bulk-action-btn">
                <i class="fas fa-trash"></i>ì„ íƒí•­ëª© ì‚­ì œ
            </button>
            <span id="selection-count" class="text-purple-300 text-sm">0ê°œ ì„ íƒë¨</span>
        </div>
        
        <!-- ì˜ˆì¸¡ ëª©ë¡ -->
        <div id="predictions-container">
            <!-- ì˜ˆì¸¡ ì¹´ë“œë“¤ì´ ë™ì ìœ¼ë¡œ ë¡œë“œë©ë‹ˆë‹¤ -->
        </div>
        
        <!-- ë¹ˆ ìƒíƒœ -->
        <div id="empty-state" class="glass-card empty-state" style="display: none;">
            <i class="fas fa-inbox"></i>
            <h3>ì €ì¥ëœ ì˜ˆì¸¡ì´ ì—†ìŠµë‹ˆë‹¤</h3>
            <p>AI ì•Œê³ ë¦¬ì¦˜ì„ ì‹¤í–‰í•˜ê³  ì˜ˆì¸¡ì„ ì €ì¥í•´ë³´ì„¸ìš”. ë‹¹ì²¨ë²ˆí˜¸ì™€ ë¹„êµí•˜ì—¬ ì •í™•ë„ë¥¼ í™•ì¸í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.</p>
            <a href="/algorithms" class="btn-primary">
                <i class="fas fa-brain mr-2"></i>AI ì˜ˆì¸¡ ì‹œì‘í•˜ê¸°
            </a>
        </div>
        
        <!-- ë¡œë”© ìƒíƒœ -->
        <div id="loading-state" class="text-center py-12">
            <div class="spinner mx-auto mb-4"></div>
            <p class="text-purple-300">ì €ì¥ëœ ë²ˆí˜¸ë¥¼ ë¶ˆëŸ¬ì˜¤ëŠ” ì¤‘...</p>
        </div>
    </div>
</section>

<!-- ë‹¹ì²¨ë²ˆí˜¸ í™•ì¸ ëª¨ë‹¬ -->
<div id="check-modal" class="info-modal-overlay hidden">
    <div class="check-modal">
        <div class="modal-header">
            <h2><i class="fas fa-search mr-3"></i>ë‹¹ì²¨ë²ˆí˜¸ í™•ì¸</h2>
            <button class="modal-close" id="close-check-modal">
                <i class="fas fa-times"></i>
            </button>
        </div>
        <div class="modal-body">
            <p class="text-purple-300 mb-6">ë‹¹ì²¨ë²ˆí˜¸ë¥¼ ì…ë ¥í•˜ì—¬ ì˜ˆì¸¡ ê²°ê³¼ë¥¼ í™•ì¸í•´ë³´ì„¸ìš”.</p>
            
            <div class="winning-numbers-input" id="winning-numbers-grid">
                <input type="number" class="winning-number-input" placeholder="1" min="1" max="45">
                <input type="number" class="winning-number-input" placeholder="2" min="1" max="45">
                <input type="number" class="winning-number-input" placeholder="3" min="1" max="45">
                <input type="number" class="winning-number-input" placeholder="4" min="1" max="45">
                <input type="number" class="winning-number-input" placeholder="5" min="1" max="45">
                <input type="number" class="winning-number-input" placeholder="6" min="1" max="45">
            </div>
            
            <div class="flex gap-4 justify-center">
                <button id="auto-fetch-winning" class="btn-secondary">
                    <i class="fas fa-download mr-2"></i>ìµœì‹  ë‹¹ì²¨ë²ˆí˜¸ ê°€ì ¸ì˜¤ê¸°
                </button>
                <button id="confirm-check" class="btn-primary">
                    <i class="fas fa-check mr-2"></i>í™•ì¸í•˜ê¸°
                </button>
            </div>
        </div>
    </div>
</div>

<!-- ìˆ˜ë™ ì¶”ê°€ ëª¨ë‹¬ -->
<div id="manual-modal" class="info-modal-overlay hidden">
    <div class="check-modal">
        <div class="modal-header">
            <h2><i class="fas fa-plus mr-3"></i>ìˆ˜ë™ ë²ˆí˜¸ ì¶”ê°€</h2>
            <button class="modal-close" id="close-manual-modal">
                <i class="fas fa-times"></i>
            </button>
        </div>
        <div class="modal-body">
            <p class="text-purple-300 mb-6">ì§ì ‘ ë²ˆí˜¸ë¥¼ ì…ë ¥í•˜ì—¬ ì˜ˆì¸¡ì— ì¶”ê°€í•´ë³´ì„¸ìš”.</p>
            
            <div class="winning-numbers-input" id="manual-numbers-grid">
                <input type="number" class="winning-number-input" placeholder="1" min="1" max="45">
                <input type="number" class="winning-number-input" placeholder="2" min="1" max="45">
                <input type="number" class="winning-number-input" placeholder="3" min="1" max="45">
                <input type="number" class="winning-number-input" placeholder="4" min="1" max="45">
                <input type="number" class="winning-number-input" placeholder="5" min="1" max="45">
                <input type="number" class="winning-number-input" placeholder="6" min="1" max="45">
            </div>
            
            <div class="mb-4">
                <label class="filter-label mb-2 block">ë©”ëª¨ (ì„ íƒì‚¬í•­)</label>
                <input type="text" id="manual-note" class="search-input" placeholder="ì˜ˆ: ê°€ì¡± ìƒì¼, íŠ¹ë³„í•œ ë‚ ì§œ ë“±">
            </div>
            
            <div class="flex gap-4 justify-center">
                <button id="random-manual" class="btn-secondary">
                    <i class="fas fa-random mr-2"></i>ëœë¤ ìƒì„±
                </button>
                <button id="confirm-manual" class="btn-primary">
                    <i class="fas fa-save mr-2"></i>ì €ì¥í•˜ê¸°
                </button>
            </div>
        </div>
    </div>
</div>
{% endblock %}

{% block extra_js %}
<script>
class SavedNumbersManager {
    constructor() {
        this.predictions = [];
        this.selectedPredictions = [];
        this.currentFilter = 'all';
        this.currentSort = 'date-desc';
        this.currentPredictionForCheck = null;
        this.init();
    }
    
    async init() {
        this.setupEventListeners();
        await this.loadPredictions();
        this.renderPredictions();
        console.log('ğŸ’¾ ì €ì¥ëœ ë²ˆí˜¸ ê´€ë¦¬ì ì´ˆê¸°í™” ì™„ë£Œ');
    }
    
    setupEventListeners() {
        // í•„í„°ë§ ë° ì •ë ¬
        document.getElementById('sort-select').addEventListener('change', (e) => {
            this.currentSort = e.target.value;
            this.renderPredictions();
        });
        
        document.getElementById('filter-select').addEventListener('change', (e) => {
            this.currentFilter = e.target.value;
            this.renderPredictions();
        });
        
        document.getElementById('search-input').addEventListener('input', (e) => {
            this.searchPredictions(e.target.value);
        });
        
        // ì¼ê´„ ì‘ì—…
        document.getElementById('select-all').addEventListener('click', () => this.selectAll());
        document.getElementById('bulk-check').addEventListener('click', () => this.bulkCheck());
        document.getElementById('bulk-delete').addEventListener('click', () => this.bulkDelete());
        
        // ìˆ˜ë™ ì¶”ê°€
        document.getElementById('add-manual').addEventListener('click', () => this.showManualModal());
        
        // ëª¨ë‹¬ ê´€ë ¨
        this.setupModalListeners();
    }
    
    setupModalListeners() {
        // í™•ì¸ ëª¨ë‹¬
        document.getElementById('close-check-modal').addEventListener('click', () => this.closeModal('check-modal'));
        document.getElementById('auto-fetch-winning').addEventListener('click', () => this.fetchLatestWinning());
        document.getElementById('confirm-check').addEventListener('click', () => this.confirmCheck());
        
        // ìˆ˜ë™ ì¶”ê°€ ëª¨ë‹¬
        document.getElementById('close-manual-modal').addEventListener('click', () => this.closeModal('manual-modal'));
        document.getElementById('random-manual').addEventListener('click', () => this.generateRandomManual());
        document.getElementById('confirm-manual').addEventListener('click', () => this.confirmManual());
        
        // ëª¨ë‹¬ ì™¸ë¶€ í´ë¦­
        document.getElementById('check-modal').addEventListener('click', (e) => {
            if (e.target.id === 'check-modal') this.closeModal('check-modal');
        });
        document.getElementById('manual-modal').addEventListener('click', (e) => {
            if (e.target.id === 'manual-modal') this.closeModal('manual-modal');
        });
        
        // ë‹¹ì²¨ë²ˆí˜¸ ì…ë ¥ ìë™ ì´ë™
        this.setupNumberInputs('winning-numbers-grid');
        this.setupNumberInputs('manual-numbers-grid');
    }
    
    setupNumberInputs(containerId) {
        const container = document.getElementById(containerId);
        const inputs = container.querySelectorAll('input');
        
        inputs.forEach((input, index) => {
            input.addEventListener('input', (e) => {
                const value = parseInt(e.target.value);
                
                // ë²”ìœ„ ê²€ì¦
                if (value < 1 || value > 45) {
                    e.target.classList.add('input-error');
                } else {
                    e.target.classList.remove('input-error');
                    
                    // ë‹¤ìŒ ì…ë ¥ìœ¼ë¡œ ì´ë™
                    if (value && index < inputs.length - 1) {
                        setTimeout(() => inputs[index + 1].focus(), 100);
                    }
                }
                
                this.validateNumberInputs(containerId);
            });
            
            input.addEventListener('keypress', (e) => {
                if (e.key === 'Enter' && index < inputs.length - 1) {
                    inputs[index + 1].focus();
                }
            });
        });
    }
    
    validateNumberInputs(containerId) {
        const container = document.getElementById(containerId);
        const inputs = container.querySelectorAll('input');
        const values = [];
        
        inputs.forEach(input => {
            input.classList.remove('input-duplicate');
            const value = parseInt(input.value);
            
            if (value && value >= 1 && value <= 45) {
                if (values.includes(value)) {
                    // ì¤‘ë³µ ë°œê²¬
                    const duplicateInputs = Array.from(inputs).filter(inp => parseInt(inp.value) === value);
                    duplicateInputs.forEach(inp => inp.classList.add('input-duplicate'));
                } else {
                    values.push(value);
                }
            }
        });
        
        return values.length === 6 && values.every(v => v >= 1 && v <= 45);
    }
    
    async loadPredictions() {
        try {
            document.getElementById('loading-state').style.display = 'block';
            
            const response = await fetch('/api/user-predictions');
            const data = await response.json();
            
            this.predictions = data.predictions || [];
            this.updateStats(data.stats || {});
            
        } catch (error) {
            console.error('ì˜ˆì¸¡ ë¡œë“œ ì‹¤íŒ¨:', error);
            window.showToast('ë°ì´í„°ë¥¼ ë¶ˆëŸ¬ì˜¤ëŠ”ë° ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤', 'error');
        } finally {
            document.getElementById('loading-state').style.display = 'none';
        }
    }
    
    updateStats(stats) {
        document.getElementById('total-predictions').textContent = stats.total_predictions || 0;
        document.getElementById('total-matches').textContent = stats.total_matches || 0;
        document.getElementById('best-match').textContent = stats.best_match || 0;
        
        const accuracy = stats.total_predictions > 0 
            ? Math.round((stats.total_matches / (stats.total_predictions * 6)) * 100)
            : 0;
        document.getElementById('accuracy-rate').textContent = accuracy + '%';
    }
    
    renderPredictions() {
        const container = document.getElementById('predictions-container');
        const emptyState = document.getElementById('empty-state');
        
        let filteredPredictions = this.filterPredictions();
        filteredPredictions = this.sortPredictions(filteredPredictions);
        
        if (filteredPredictions.length === 0) {
            container.innerHTML = '';
            emptyState.style.display = 'block';
            return;
        }
        
        emptyState.style.display = 'none';
        container.innerHTML = '';
        
        filteredPredictions.forEach(prediction => {
            const card = this.createPredictionCard(prediction);
            container.appendChild(card);
        });
        
        // ì• ë‹ˆë©”ì´ì…˜
        const cards = container.children;
        Array.from(cards).forEach((card, index) => {
            card.style.opacity = '0';
            card.style.transform = 'translateY(20px)';
            
            setTimeout(() => {
                card.style.transition = 'all 0.5s ease-out';
                card.style.opacity = '1';
                card.style.transform = 'translateY(0)';
            }, index * 50);
        });
    }
    
    filterPredictions() {
        return this.predictions.filter(prediction => {
            switch(this.currentFilter) {
                case 'checked':
                    return prediction.is_checked;
                case 'unchecked':
                    return !prediction.is_checked;
                case 'matches':
                    return prediction.is_checked && prediction.match_result && prediction.match_result.matches > 0;
                default:
                    return true;
            }
        });
    }
    
    sortPredictions(predictions) {
        return predictions.sort((a, b) => {
            switch(this.currentSort) {
                case 'date-asc':
                    return new Date(a.timestamp) - new Date(b.timestamp);
                case 'matches-desc':
                    const aMatches = a.match_result ? a.match_result.matches : -1;
                    const bMatches = b.match_result ? b.match_result.matches : -1;
                    return bMatches - aMatches;
                case 'matches-asc':
                    const aMatchesAsc = a.match_result ? a.match_result.matches : Infinity;
                    const bMatchesAsc = b.match_result ? b.match_result.matches : Infinity;
                    return aMatchesAsc - bMatchesAsc;
                case 'date-desc':
                default:
                    return new Date(b.timestamp) - new Date(a.timestamp);
            }
        });
    }
    
    searchPredictions(query) {
        const container = document.getElementById('predictions-container');
        const cards = container.querySelectorAll('.prediction-card');
        
        cards.forEach(card => {
            const algorithmName = card.querySelector('.prediction-algorithm').textContent.toLowerCase();
            const isMatch = algorithmName.includes(query.toLowerCase());
            card.style.display = isMatch ? 'block' : 'none';
        });
    }
    
    createPredictionCard(prediction) {
        const card = document.createElement('div');
        card.className = `prediction-card ${prediction.is_checked ? 'checked' : ''}`;
        card.dataset.id = prediction.id;
        
        const date = new Date(prediction.timestamp).toLocaleDateString('ko-KR', {
            year: 'numeric',
            month: 'long',
            day: 'numeric',
            hour: '2-digit',
            minute: '2-digit'
        });
        
        card.innerHTML = `
            <div class="prediction-header">
                <div class="prediction-meta">
                    <div class="prediction-date">${date}</div>
                    <div class="prediction-algorithm">${this.getAlgorithmDisplayName(prediction.algorithm)}</div>
                </div>
                <div class="prediction-actions">
                    <button class="action-btn copy" title="ë³µì‚¬" onclick="savedNumbersManager.copyNumbers('${prediction.id}')">
                        <i class="fas fa-copy"></i>
                    </button>
                    <button class="action-btn check" title="ë‹¹ì²¨ í™•ì¸" onclick="savedNumbersManager.checkPrediction('${prediction.id}')">
                        <i class="fas fa-search"></i>
                    </button>
                    <button class="action-btn delete" title="ì‚­ì œ" onclick="savedNumbersManager.deletePrediction('${prediction.id}')">
                        <i class="fas fa-trash"></i>
                    </button>
                </div>
            </div>
            
            <div class="prediction-numbers">
                ${prediction.numbers.map(num => `
                    <div class="prediction-number ${this.isNumberMatched(num, prediction) ? 'matched' : ''}">
                        ${num}
                    </div>
                `).join('')}
            </div>
            
            ${prediction.is_checked ? this.renderMatchResult(prediction.match_result) : ''}
        `;
        
        return card;
    }
    
    getAlgorithmDisplayName(algorithmId) {
        if (window.githubManager && window.githubManager.algorithms[algorithmId]) {
            return window.githubManager.algorithms[algorithmId].name;
        }
        return algorithmId.replace(/_/g, ' ').replace(/\b\w/g, l => l.toUpperCase());
    }
    
    isNumberMatched(number, prediction) {
        if (!prediction.is_checked || !prediction.match_result) return false;
        return prediction.match_result.matched_numbers.includes(number);
    }
    
    renderMatchResult(matchResult) {
        if (!matchResult) return '';
        
        const prizeInfo = this.getPrizeInfo(matchResult.matches);
        
        return `
            <div class="match-result">
                <div class="match-summary">
                    <div class="match-count">
                        ì ì¤‘: <span class="number">${matchResult.matches}</span>ê°œ
                    </div>
                    <div class="match-prize">${prizeInfo}</div>
                </div>
                
                <div class="text-sm text-gray-400 mb-2">ë§¤ì¹˜ëœ ë²ˆí˜¸:</div>
                <div class="matched-numbers">
                    ${matchResult.matched_numbers.map(num => `
                        <div class="matched-number">${num}</div>
                    `).join('')}
                </div>
            </div>
        `;
    }
    
    getPrizeInfo(matches) {
        const prizes = {
            6: '1ë“± ğŸ‰',
            5: '2ë“± ğŸ†',
            4: '3ë“± ğŸ¥‰',
            3: '4ë“± ğŸ’°',
            2: '5ë“± ğŸ’µ',
            1: 'ê½ ğŸ˜…',
            0: 'ê½ ğŸ˜­'
        };
        
        return prizes[matches] || 'ê½ ğŸ˜…';
    }
    
    async copyNumbers(predictionId) {
        const prediction = this.predictions.find(p => p.id === predictionId);
        if (!prediction) return;
        
        const numbersText = prediction.numbers.join(', ');
        
        try {
            await navigator.clipboard.writeText(numbersText);
            window.showToast('ë²ˆí˜¸ê°€ ë³µì‚¬ë˜ì—ˆìŠµë‹ˆë‹¤', 'success', 2000);
        } catch (error) {
            // í´ë°±
            const textArea = document.createElement('textarea');
            textArea.value = numbersText;
            document.body.appendChild(textArea);
            textArea.select();
            document.execCommand('copy');
            document.body.removeChild(textArea);
            
            window.showToast('ë²ˆí˜¸ê°€ ë³µì‚¬ë˜ì—ˆìŠµë‹ˆë‹¤', 'success', 2000);
        }
    }
    
    checkPrediction(predictionId) {
        this.currentPredictionForCheck = predictionId;
        this.showModal('check-modal');
    }
    
    async deletePrediction(predictionId) {
        if (!confirm('ì´ ì˜ˆì¸¡ì„ ì‚­ì œí•˜ì‹œê² ìŠµë‹ˆê¹Œ?')) return;
        
        try {
            // API í˜¸ì¶œë¡œ ì„œë²„ì—ì„œ ì‚­ì œ
            const response = await fetch(`/api/delete-prediction/${predictionId}`, {
                method: 'DELETE'
            });
            
            if (response.ok) {
                // ë¡œì»¬ì—ì„œë„ ì œê±°
                this.predictions = this.predictions.filter(p => p.id !== predictionId);
                this.renderPredictions();
                window.showToast('ì˜ˆì¸¡ì´ ì‚­ì œë˜ì—ˆìŠµë‹ˆë‹¤', 'success');
            } else {
                window.showToast('ì‚­ì œì— ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤', 'error');
            }
        } catch (error) {
            console.error('ì‚­ì œ ì‹¤íŒ¨:', error);
            window.showToast('ì‚­ì œ ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤', 'error');
        }
    }
    
    showModal(modalId) {
        const modal = document.getElementById(modalId);
        modal.classList.remove('hidden');
        setTimeout(() => modal.classList.add('show'), 10);
    }
    
    closeModal(modalId) {
        const modal = document.getElementById(modalId);
        modal.classList.remove('show');
        setTimeout(() => modal.classList.add('hidden'), 300);
    }
    
    async fetchLatestWinning() {
        try {
            // ìµœì‹  ë‹¹ì²¨ë²ˆí˜¸ API í˜¸ì¶œ
            const response = await fetch('/api/latest-winning-numbers');
            const data = await response.json();
            
            if (data.status === 'success' && data.numbers) {
                const inputs = document.querySelectorAll('#winning-numbers-grid input');
                data.numbers.forEach((num, index) => {
                    if (inputs[index]) {
                        inputs[index].value = num;
                    }
                });
                
                window.showToast('ìµœì‹  ë‹¹ì²¨ë²ˆí˜¸ë¥¼ ê°€ì ¸ì™”ìŠµë‹ˆë‹¤', 'success');
            } else {
                window.showToast('ë‹¹ì²¨ë²ˆí˜¸ë¥¼ ê°€ì ¸ì˜¬ ìˆ˜ ì—†ìŠµë‹ˆë‹¤', 'warning');
            }
        } catch (error) {
            console.error('ë‹¹ì²¨ë²ˆí˜¸ ê°€ì ¸ì˜¤ê¸° ì‹¤íŒ¨:', error);
            window.showToast('ë‹¹ì²¨ë²ˆí˜¸ë¥¼ ê°€ì ¸ì˜¬ ìˆ˜ ì—†ìŠµë‹ˆë‹¤', 'error');
        }
    }
    
    async confirmCheck() {
        if (!this.validateNumberInputs('winning-numbers-grid')) {
            window.showToast('ì˜¬ë°”ë¥¸ ë‹¹ì²¨ë²ˆí˜¸ë¥¼ ì…ë ¥í•´ì£¼ì„¸ìš” (1-45, ì¤‘ë³µ ì—†ìŒ)', 'warning');
            return;
        }
        
        const inputs = document.querySelectorAll('#winning-numbers-grid input');
        const winningNumbers = Array.from(inputs).map(input => parseInt(input.value));
        
        try {
            const response = await fetch('/api/compare-numbers', {
                method: 'POST',
                headers: { 'Content-Type': 'application/json' },
                body: JSON.stringify({
                    prediction_id: this.currentPredictionForCheck,
                    winning_numbers: winningNumbers
                })
            });
            
            const result = await response.json();
            
            if (result.status === 'success') {
                // ë¡œì»¬ ë°ì´í„° ì—…ë°ì´íŠ¸
                const prediction = this.predictions.find(p => p.id === this.currentPredictionForCheck);
                if (prediction) {
                    prediction.is_checked = true;
                    prediction.match_result = result.result;
                }
                
                this.closeModal('check-modal');
                this.renderPredictions();
                
                const matches = result.matches;
                const prizeInfo = this.getPrizeInfo(matches);
                window.showToast(`ê²°ê³¼: ${matches}ê°œ ì ì¤‘! ${prizeInfo}`, matches > 0 ? 'success' : 'info', 5000);
                
            } else {
                window.showToast('í™•ì¸ ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤', 'error');
            }
            
        } catch (error) {
            console.error('ë‹¹ì²¨ í™•ì¸ ì‹¤íŒ¨:', error);
            window.showToast('í™•ì¸ ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤', 'error');
        }
    }
    
    showManualModal() {
        this.showModal('manual-modal');
    }
    
    generateRandomManual() {
        const numbers = [];
        while (numbers.length < 6) {
            const num = Math.floor(Math.random() * 45) + 1;
            if (!numbers.includes(num)) {
                numbers.push(num);
            }
        }
        numbers.sort((a, b) => a - b);
        
        const inputs = document.querySelectorAll('#manual-numbers-grid input');
        numbers.forEach((num, index) => {
            if (inputs[index]) {
                inputs[index].value = num;
            }
        });
    }
    
    async confirmManual() {
        if (!this.validateNumberInputs('manual-numbers-grid')) {
            window.showToast('ì˜¬ë°”ë¥¸ ë²ˆí˜¸ë¥¼ ì…ë ¥í•´ì£¼ì„¸ìš” (1-45, ì¤‘ë³µ ì—†ìŒ)', 'warning');
            return;
        }
        
        const inputs = document.querySelectorAll('#manual-numbers-grid input');
        const numbers = Array.from(inputs).map(input => parseInt(input.value)).sort((a, b) => a - b);
        const note = document.getElementById('manual-note').value;
        
        try {
            const response = await fetch('/api/save-prediction', {
                method: 'POST',
                headers: { 'Content-Type': 'application/json' },
                body: JSON.stringify({
                    numbers: numbers,
                    algorithm: 'manual',
                    timestamp: new Date().toISOString(),
                    note: note
                })
            });
            
            const result = await response.json();
            
            if (result.status === 'success') {
                await this.loadPredictions();
                this.renderPredictions();
                this.closeModal('manual-modal');
                
                // ì…ë ¥ ì´ˆê¸°í™”
                inputs.forEach(input => input.value = '');
                document.getElementById('manual-note').value = '';
                
                window.showToast('ìˆ˜ë™ ë²ˆí˜¸ê°€ ì¶”ê°€ë˜ì—ˆìŠµë‹ˆë‹¤', 'success');
            } else {
                window.showToast('ì €ì¥ì— ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤', 'error');
            }
        } catch (error) {
            console.error('ìˆ˜ë™ ì €ì¥ ì‹¤íŒ¨:', error);
            window.showToast('ì €ì¥ ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤', 'error');
        }
    }
    
    // ì¼ê´„ ì‘ì—… ë©”ì„œë“œë“¤
    selectAll() {
        // êµ¬í˜„ ì˜ˆì •
        console.log('ì „ì²´ ì„ íƒ ê¸°ëŠ¥');
    }
    
    bulkCheck() {
        // êµ¬í˜„ ì˜ˆì •
        console.log('ì¼ê´„ í™•ì¸ ê¸°ëŠ¥');
    }
    
    bulkDelete() {
        // êµ¬í˜„ ì˜ˆì •
        console.log('ì¼ê´„ ì‚­ì œ ê¸°ëŠ¥');
    }
}

// ì „ì—­ ì¸ìŠ¤í„´ìŠ¤
let savedNumbersManager;

document.addEventListener('DOMContentLoaded', function() {
    savedNumbersManager = new SavedNumbersManager();
    window.savedNumbersManager = savedNumbersManager;
});
</script>
{% endblock %}
