{% extends "base.html" %}

{% block title %}AI 알고리즘 - LottoPro-AI{% endblock %}
{% block nav_algorithms %}active{% endblock %}

{% block content %}
<div class="algorithms-container">
    <div class="algorithms-header">
        <h1>🧠 AI 알고리즘</h1>
        <p class="subtitle">각기 다른 방식으로 분석하는 8가지 독자적 AI 모델로<br>최고의 로또 예측 정확도를 경험해보세요</p>
    </div>

    <!-- 필터 컨트롤 -->
    <div class="filter-controls">
        <div class="control-group">
            <label for="sort-select">
                <span class="control-icon">📊</span>
                정렬:
            </label>
            <select id="sort-select" class="control-select">
                <option value="accuracy" selected>정확도순</option>
                <option value="name">이름순</option>
            </select>
        </div>

        <div class="control-group">
            <label for="filter-select">
                <span class="control-icon">🔍</span>
                필터:
            </label>
            <select id="filter-select" class="control-select">
                <option value="all" selected>전체</option>
                <option value="high">높은 정확도 (85%+)</option>
                <option value="medium">중간 정확도 (70-85%)</option>
                <option value="low">기타 (70% 미만)</option>
            </select>
        </div>

        <div class="control-group">
            <button id="refresh-btn" class="control-button">
                <span class="btn-icon">🔄</span>
                <span class="btn-text">새로고침</span>
            </button>
        </div>
    </div>

    <!-- 알고리즘 그리드 -->
    <div id="algorithm-grid" class="algorithm-grid">
        <div class="loading-spinner">
            <div class="spinner"></div>
            <p>알고리즘 로딩 중...</p>
        </div>
    </div>
</div>
{% endblock %}

{% block extra_js %}
<script>
document.addEventListener('DOMContentLoaded', function() {
    console.log('🧠 알고리즘 페이지 초기화');

    // 정렬 이벤트
    const sortSelect = document.getElementById('sort-select');
    if (sortSelect) {
        sortSelect.addEventListener('change', function() {
            const sortBy = this.value;
            const filterBy = document.getElementById('filter-select')?.value || 'all';
            console.log('정렬 변경:', sortBy);
            if (window.githubAPIManager) {
                window.githubAPIManager.renderAlgorithmCards('algorithm-grid', sortBy, filterBy);
            }
        });
    }

    // 필터 이벤트
    const filterSelect = document.getElementById('filter-select');
    if (filterSelect) {
        filterSelect.addEventListener('change', function() {
            const filterBy = this.value;
            const sortBy = document.getElementById('sort-select')?.value || 'accuracy';
            console.log('필터 변경:', filterBy);
            if (window.githubAPIManager) {
                window.githubAPIManager.renderAlgorithmCards('algorithm-grid', sortBy, filterBy);
            }
        });
    }

    // 새로고침 버튼
    const refreshBtn = document.getElementById('refresh-btn');
    if (refreshBtn) {
        refreshBtn.addEventListener('click', async function() {
            console.log('새로고침 시작');
            this.disabled = true;
            this.innerHTML = '<span class="btn-icon">⏳</span><span class="btn-text">로딩 중...</span>';
            
            if (window.githubAPIManager) {
                await window.githubAPIManager.loadAlgorithmInfo();
                const sortBy = document.getElementById('sort-select')?.value || 'accuracy';
                const filterBy = document.getElementById('filter-select')?.value || 'all';
                window.githubAPIManager.renderAlgorithmCards('algorithm-grid', sortBy, filterBy);
            }
            
            this.disabled = false;
            this.innerHTML = '<span class="btn-icon">🔄</span><span class="btn-text">새로고침</span>';
        });
    }
});

// 번호 저장 함수
function saveNumbers(numbers) {
    console.log('번호 저장:', numbers);
    
    try {
        const savedNumbers = JSON.parse(localStorage.getItem('savedNumbers') || '[]');
        const newEntry = {
            id: Date.now(),
            numbers: numbers,
            timestamp: new Date().toISOString(),
            algorithm: 'AI 예측',
            checked: false
        };
        
        savedNumbers.unshift(newEntry); // 맨 앞에 추가
        localStorage.setItem('savedNumbers', JSON.stringify(savedNumbers));
        
        alert('번호가 저장되었습니다! 저장된 번호 페이지에서 확인할 수 있습니다.');
        
        // 저장된 개수 표시
        console.log('총 저장된 번호:', savedNumbers.length);
    } catch (error) {
        console.error('저장 실패:', error);
        alert('번호 저장에 실패했습니다.');
    }
}
</script>
{% endblock %}
