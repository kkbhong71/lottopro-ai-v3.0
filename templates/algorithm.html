{% extends "base.html" %}

{% block title %}AI ì•Œê³ ë¦¬ì¦˜ - LottoPro-AI{% endblock %}
{% block nav_algorithms %}active{% endblock %}

{% block content %}
<div class="algorithms-container">
    <div class="algorithms-header">
        <h1>ğŸ§  AI ì•Œê³ ë¦¬ì¦˜</h1>
        <p class="subtitle">
            ê°ê¸° ë‹¤ë¥¸ ë°©ì‹ìœ¼ë¡œ ë¶„ì„í•˜ëŠ” 8ê°€ì§€ ë…ìì  AI ëª¨ë¸ë¡œ<br>
            ìµœê³ ì˜ ë¡œë˜ ì˜ˆì¸¡ ì •í™•ë„ë¥¼ ê²½í—˜í•´ë³´ì„¸ìš”
        </p>
    </div>

    <!-- í•„í„° ì»¨íŠ¸ë¡¤ -->
    <div class="filter-controls">
        <div class="control-group">
            <label for="sort-select">
                <span class="control-icon">ğŸ“Š</span>
                ì •ë ¬:
            </label>
            <select id="sort-select" class="control-select">
                <option value="accuracy" selected>ì •í™•ë„ìˆœ</option>
                <option value="name">ì´ë¦„ìˆœ</option>
            </select>
        </div>

        <div class="control-group">
            <label for="filter-select">
                <span class="control-icon">ğŸ”</span>
                í•„í„°:
            </label>
            <select id="filter-select" class="control-select">
                <option value="all" selected>ì „ì²´</option>
                <option value="high">ë†’ì€ ì •í™•ë„ (85%+)</option>
                <option value="medium">ì¤‘ê°„ ì •í™•ë„ (70-85%)</option>
                <option value="low">ê¸°íƒ€ (70% ë¯¸ë§Œ)</option>
            </select>
        </div>

        <div class="control-group">
            <button id="refresh-btn" class="control-button">
                <span class="btn-icon">ğŸ”„</span>
                <span class="btn-text">ìƒˆë¡œê³ ì¹¨</span>
            </button>
        </div>
    </div>

    <!-- ì•Œê³ ë¦¬ì¦˜ ê·¸ë¦¬ë“œ -->
    <div id="algorithm-grid" class="algorithm-grid">
        <div class="loading-spinner">
            <div class="spinner"></div>
            <p>ì•Œê³ ë¦¬ì¦˜ ë¡œë”© ì¤‘...</p>
        </div>
    </div>
</div>
{% endblock %}

{% block extra_js %}
<script>
document.addEventListener('DOMContentLoaded', function() {
    console.log('ğŸ§  ì•Œê³ ë¦¬ì¦˜ í˜ì´ì§€ ì´ˆê¸°í™”');

    // ===== ì •ë ¬ ì´ë²¤íŠ¸ =====
    const sortSelect = document.getElementById('sort-select');
    if (sortSelect) {
        sortSelect.addEventListener('change', function() {
            const sortBy = this.value;
            const filterBy = document.getElementById('filter-select')?.value || 'all';
            console.log('ğŸ“Š ì •ë ¬ ë³€ê²½:', sortBy);
            
            if (window.githubAPIManager && window.githubAPIManager.initialized) {
                window.githubAPIManager.renderAlgorithmCards('algorithm-grid', sortBy, filterBy);
            } else {
                console.warn('âš ï¸ GitHubAPIManagerê°€ ì•„ì§ ì´ˆê¸°í™”ë˜ì§€ ì•Šì•˜ìŠµë‹ˆë‹¤');
            }
        });
    }

    // ===== í•„í„° ì´ë²¤íŠ¸ =====
    const filterSelect = document.getElementById('filter-select');
    if (filterSelect) {
        filterSelect.addEventListener('change', function() {
            const filterBy = this.value;
            const sortBy = document.getElementById('sort-select')?.value || 'accuracy';
            console.log('ğŸ” í•„í„° ë³€ê²½:', filterBy);
            
            if (window.githubAPIManager && window.githubAPIManager.initialized) {
                window.githubAPIManager.renderAlgorithmCards('algorithm-grid', sortBy, filterBy);
            } else {
                console.warn('âš ï¸ GitHubAPIManagerê°€ ì•„ì§ ì´ˆê¸°í™”ë˜ì§€ ì•Šì•˜ìŠµë‹ˆë‹¤');
            }
        });
    }

    // ===== ìƒˆë¡œê³ ì¹¨ ë²„íŠ¼ =====
    const refreshBtn = document.getElementById('refresh-btn');
    if (refreshBtn) {
        refreshBtn.addEventListener('click', async function() {
            console.log('ğŸ”„ ìƒˆë¡œê³ ì¹¨ ì‹œì‘');
            
            // ë²„íŠ¼ ë¹„í™œì„±í™”
            this.disabled = true;
            this.innerHTML = '<span class="btn-icon">â³</span><span class="btn-text">ë¡œë”© ì¤‘...</span>';
            
            try {
                if (window.githubAPIManager) {
                    // ì•Œê³ ë¦¬ì¦˜ ì •ë³´ ì¬ë¡œë“œ
                    await window.githubAPIManager.loadAlgorithmInfo();
                    
                    // í˜„ì¬ ì„¤ì •ìœ¼ë¡œ ì¹´ë“œ ë Œë”ë§
                    const sortBy = document.getElementById('sort-select')?.value || 'accuracy';
                    const filterBy = document.getElementById('filter-select')?.value || 'all';
                    window.githubAPIManager.renderAlgorithmCards('algorithm-grid', sortBy, filterBy);
                    
                    // ì„±ê³µ ë©”ì‹œì§€
                    if (window.showToast) {
                        window.showToast('ì•Œê³ ë¦¬ì¦˜ ì •ë³´ê°€ ìƒˆë¡œê³ ì¹¨ë˜ì—ˆìŠµë‹ˆë‹¤', 'success');
                    }
                } else {
                    throw new Error('GitHubAPIManagerë¥¼ ì°¾ì„ ìˆ˜ ì—†ìŠµë‹ˆë‹¤');
                }
            } catch (error) {
                console.error('âŒ ìƒˆë¡œê³ ì¹¨ ì‹¤íŒ¨:', error);
                if (window.showToast) {
                    window.showToast('ìƒˆë¡œê³ ì¹¨ ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤', 'error');
                }
            } finally {
                // ë²„íŠ¼ ë³µì›
                this.disabled = false;
                this.innerHTML = '<span class="btn-icon">ğŸ”„</span><span class="btn-text">ìƒˆë¡œê³ ì¹¨</span>';
            }
        });
    }

    // ===== ì´ˆê¸°í™” í™•ì¸ =====
    console.log('ğŸ“Š í˜ì´ì§€ ìƒíƒœ:', {
        githubAPIManager: window.githubAPIManager ? 'âœ…' : 'âŒ',
        initialized: window.githubAPIManager?.initialized ? 'âœ…' : 'âŒ',
        algorithmCount: window.githubAPIManager ? Object.keys(window.githubAPIManager.algorithms).length : 0
    });
});

// ===== ì „ì—­ ë²ˆí˜¸ ì €ì¥ í•¨ìˆ˜ (í•˜ìœ„ í˜¸í™˜ì„±) =====
// window.saveNumbersê°€ main.jsì—ì„œ ì •ì˜ë˜ì–´ ìˆì§€ë§Œ, 
// ë§Œì•½ì„ ëŒ€ë¹„í•œ í´ë°± í•¨ìˆ˜
if (typeof window.saveNumbers === 'undefined') {
    window.saveNumbers = function(numbers, algorithmName) {
        console.log('ğŸ’¾ ë²ˆí˜¸ ì €ì¥ (í´ë°± í•¨ìˆ˜):', numbers, algorithmName);
        
        try {
            // ë²ˆí˜¸ ìœ íš¨ì„± ê²€ì‚¬
            if (!Array.isArray(numbers) || numbers.length !== 6) {
                throw new Error('ì˜ëª»ëœ ë²ˆí˜¸ í˜•ì‹');
            }
            
            // ë¡œì»¬ ìŠ¤í† ë¦¬ì§€ì—ì„œ ê¸°ì¡´ ë°ì´í„° ë¡œë“œ
            const savedNumbers = JSON.parse(localStorage.getItem('savedNumbers') || '[]');
            
            // ìƒˆ í•­ëª© ìƒì„±
            const newEntry = {
                id: Date.now(),
                numbers: numbers,
                timestamp: new Date().toISOString(),
                algorithm: algorithmName || 'AI ì˜ˆì¸¡',
                checked: false,
                matches: 0
            };
            
            // ë§¨ ì•ì— ì¶”ê°€
            savedNumbers.unshift(newEntry);
            
            // ìµœëŒ€ 100ê°œê¹Œì§€ë§Œ ìœ ì§€
            const trimmed = savedNumbers.slice(0, 100);
            
            // ì €ì¥
            localStorage.setItem('savedNumbers', JSON.stringify(trimmed));
            
            console.log('âœ… ë²ˆí˜¸ ì €ì¥ ì™„ë£Œ. ì´ ê°œìˆ˜:', trimmed.length);
            
            // ì„±ê³µ ë©”ì‹œì§€
            if (window.showToast) {
                window.showToast('ë²ˆí˜¸ê°€ ì €ì¥ë˜ì—ˆìŠµë‹ˆë‹¤!', 'success');
            } else {
                alert('ë²ˆí˜¸ê°€ ì €ì¥ë˜ì—ˆìŠµë‹ˆë‹¤! ì €ì¥ëœ ë²ˆí˜¸ í˜ì´ì§€ì—ì„œ í™•ì¸í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.');
            }
            
            return true;
        } catch (error) {
            console.error('âŒ ì €ì¥ ì‹¤íŒ¨:', error);
            
            if (window.showToast) {
                window.showToast('ë²ˆí˜¸ ì €ì¥ì— ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤', 'error');
            } else {
                alert('ë²ˆí˜¸ ì €ì¥ì— ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤: ' + error.message);
            }
            
            return false;
        }
    };
    
    console.log('ğŸ“¦ saveNumbers í´ë°± í•¨ìˆ˜ ë“±ë¡ë¨');
}
</script>
{% endblock %}
